# Circle.yml For stable.world
machine:
  python:
    version: 3.5.1
  environment:
    CONTAINER: stable.world
    GCLOUD_ZONE: us-central1-a
    GCLOUD_PROJECT: my-project-1-152801
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
    - docker
  post:
    - pyenv global 2.7.12 3.4.4


dependencies:
  pre:
    - sudo apt-get update
    - pip install --upgrade pip setuptools wheel

compile:
  override:
    - yarn build:app
    - cp ./bin/stable.world $CIRCLE_ARTIFACTS

    - yarn build:docker:py2
    - yarn build:docker:py3

test:
  pre:
    - flake8
  override:

    - yarn test:py2
    - yarn test:py3
    - ./bin/stable.world --help

  post:

    - python setup.py sdist bdist_wheel
    - cp ./dist/* $CIRCLE_ARTIFACTS

deployment:
  development:
    branch: develop
    commands:
      - pyenv global 2.7.12
      - yarn run deploy:fetch
      - yarn run deploy:authorize
      - yarn run deploy:development
  master:
    branch: master
    commands:
      - pyenv global 2.7.12
      - yarn run deploy:fetch
      - yarn run deploy:authorize
      - yarn run deploy:master
