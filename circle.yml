# Circle.yml For stable.world
machine:
  python:
    version: 3.5.1
  environment:
    CONTAINER: stable.world
    GCLOUD_ZONE: us-central1-a
    GCLOUD_PROJECT: my-project-1-152801
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
    - docker
  post:
    - pyenv global 2.7.12 3.6.2


dependencies:
  pre:
    - sudo apt-get update
    - pip install --upgrade pip setuptools wheel

compile:
  override:
    - make buildApp
    - cp ./bin/stable.world $CIRCLE_ARTIFACTS

    - make buildDockerPY2
    - make buildDockerPY3

test:
  pre:
    - make lint
  override:

    - make testPY2
    - make testPY3
    - ./bin/stable.world --help

  post:

    - python setup.py sdist bdist_wheel
    - cp ./dist/* $CIRCLE_ARTIFACTS

deployment:
  development:
    branch: develop
    commands:
      - pyenv global 2.7.12
      - make deployFetch
      - make deployAuthorize
      - make deployDevelopment
  master:
    branch: master
    commands:
      - pyenv global 2.7.12
      - make deployFetch
      - make deployAuthorize
      - make deployMaster
