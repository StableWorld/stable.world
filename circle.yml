# Circle.yml For stable.world
machine:
  python:
    version: 3.5.1
  environment:
    CONTAINER: stable.world
    GCLOUD_ZONE: us-central1-a
    GCLOUD_PROJECT: my-project-1-152801

dependencies:
  pre:
    - sudo apt-get update
    - pip install --upgrade pip setuptools wheel
  override:
    - pyenv global 2.7.12
    - pip install -r test-requirements.txt
    - python setup.py develop

    - pyenv global 3.6.0
    - pip install -r test-requirements.txt
    - python setup.py develop

compile:
  override:
    - pyenv global 3.6.0
    - yarn app

test:
  override:
    - pyenv global 2.7.12
    - py.test --junitxml $CIRCLE_TEST_REPORTS/py2.test.xml
    - ./bin/stable.world --help

    - pyenv global 3.6.0
    - py.test --junitxml $CIRCLE_TEST_REPORTS/py3.test.xml
    - ./bin/stable.world --help

  post:
    - cp ./bin/stable.world $CIRCLE_ARTIFACTS
    - python setup.py sdist bdist_wheel
    - cp ./dist/* $CIRCLE_ARTIFACTS

deployment:
  development:
    branch: develop
    commands:
      - pyenv global 2.7.12
      - yarn run deploy:fetch
      - yarn run deploy:authorize
      - yarn run deploy:development
  master:
    branch: master
    commands:
      - pyenv global 2.7.12
      - yarn run deploy:fetch
      - yarn run deploy:authorize
      - yarn run deploy:master
